var H={"Content-Type":"application/json"},I=/\{[^{}]+\}/g,E=class extends Request{constructor(t,e){super(t,e);for(let r in e)r in this||(this[r]=e[r])}};function P(){return Math.random().toString(36).slice(2,11)}function L(i){let{baseUrl:t="",fetch:e=globalThis.fetch,querySerializer:r,bodySerializer:n,headers:o,...l}={...i};t.endsWith("/")&&(t=t.substring(0,t.length-1)),o=O(H,o);let a=[];async function u(f,s){let{fetch:h=e,headers:C,params:b={},parseAs:j="json",querySerializer:m,bodySerializer:T=n??F,...D}=s||{},x=typeof r=="function"?r:z(r);m&&(x=typeof m=="function"?m:z({...typeof r=="object"?r:{},...m}));let p={redirect:"follow",...l,...D,headers:O(o,C,b.header)};p.body&&(p.body=T(p.body),p.body instanceof FormData&&p.headers.delete("Content-Type"));let g,$,R=new E(N(f,{baseUrl:t,params:b,querySerializer:x}),p);if(a.length){g=P(),$=Object.freeze({baseUrl:t,fetch:h,parseAs:j,querySerializer:x,bodySerializer:T});for(let d of a)if(d&&typeof d=="object"&&typeof d.onRequest=="function"){let y=await d.onRequest({request:R,schemaPath:f,params:b,options:$,id:g});if(y){if(!(y instanceof Request))throw new Error("onRequest: must return new Request() when modifying the request");R=y}}}let c=await h(R);if(a.length)for(let d=a.length-1;d>=0;d--){let y=a[d];if(y&&typeof y=="object"&&typeof y.onResponse=="function"){let A=await y.onResponse({request:R,response:c,schemaPath:f,params:b,options:$,id:g});if(A){if(!(A instanceof Response))throw new Error("onResponse: must return new Response() when modifying the response");c=A}}}if(c.status===204||c.headers.get("Content-Length")==="0")return c.ok?{data:{},response:c}:{error:{},response:c};if(c.ok)return j==="stream"?{data:c.body,response:c}:{data:await c[j](),response:c};let S=await c.text();try{S=JSON.parse(S)}catch{}return{error:S,response:c}}return{GET(f,s){return u(f,{...s,method:"GET"})},PUT(f,s){return u(f,{...s,method:"PUT"})},POST(f,s){return u(f,{...s,method:"POST"})},DELETE(f,s){return u(f,{...s,method:"DELETE"})},OPTIONS(f,s){return u(f,{...s,method:"OPTIONS"})},HEAD(f,s){return u(f,{...s,method:"HEAD"})},PATCH(f,s){return u(f,{...s,method:"PATCH"})},TRACE(f,s){return u(f,{...s,method:"TRACE"})},use(...f){for(let s of f)if(s){if(typeof s!="object"||!("onRequest"in s||"onResponse"in s))throw new Error("Middleware must be an object with one of `onRequest()` or `onResponse()`");a.push(s)}},eject(...f){for(let s of f){let h=a.indexOf(s);h!==-1&&a.splice(h,1)}}}}function w(i,t,e){if(t==null)return"";if(typeof t=="object")throw new Error("Deeply-nested arrays/objects aren\u2019t supported. Provide your own `querySerializer()` to handle these.");return`${i}=${e?.allowReserved===!0?t:encodeURIComponent(t)}`}function q(i,t,e){if(!t||typeof t!="object")return"";let r=[],n={simple:",",label:".",matrix:";"}[e.style]||"&";if(e.style!=="deepObject"&&e.explode===!1){for(let a in t)r.push(a,e.allowReserved===!0?t[a]:encodeURIComponent(t[a]));let l=r.join(",");switch(e.style){case"form":return`${i}=${l}`;case"label":return`.${l}`;case"matrix":return`;${i}=${l}`;default:return l}}for(let l in t){let a=e.style==="deepObject"?`${i}[${l}]`:l;r.push(w(a,t[l],e))}let o=r.join(n);return e.style==="label"||e.style==="matrix"?`${n}${o}`:o}function U(i,t,e){if(!Array.isArray(t))return"";if(e.explode===!1){let o={form:",",spaceDelimited:"%20",pipeDelimited:"|"}[e.style]||",",l=(e.allowReserved===!0?t:t.map(a=>encodeURIComponent(a))).join(o);switch(e.style){case"simple":return l;case"label":return`.${l}`;case"matrix":return`;${i}=${l}`;default:return`${i}=${l}`}}let r={simple:",",label:".",matrix:";"}[e.style]||"&",n=[];for(let o of t)e.style==="simple"||e.style==="label"?n.push(e.allowReserved===!0?o:encodeURIComponent(o)):n.push(w(i,o,e));return e.style==="label"||e.style==="matrix"?`${r}${n.join(r)}`:n.join(r)}function z(i){return function(e){let r=[];if(e&&typeof e=="object")for(let n in e){let o=e[n];if(o!=null){if(Array.isArray(o)){r.push(U(n,o,{style:"form",explode:!0,...i?.array,allowReserved:i?.allowReserved||!1}));continue}if(typeof o=="object"){r.push(q(n,o,{style:"deepObject",explode:!0,...i?.object,allowReserved:i?.allowReserved||!1}));continue}r.push(w(n,o,i))}}return r.join("&")}}function k(i,t){let e=i;for(let r of i.match(I)??[]){let n=r.substring(1,r.length-1),o=!1,l="simple";if(n.endsWith("*")&&(o=!0,n=n.substring(0,n.length-1)),n.startsWith(".")?(l="label",n=n.substring(1)):n.startsWith(";")&&(l="matrix",n=n.substring(1)),!t||t[n]===void 0||t[n]===null)continue;let a=t[n];if(Array.isArray(a)){e=e.replace(r,U(n,a,{style:l,explode:o}));continue}if(typeof a=="object"){e=e.replace(r,q(n,a,{style:l,explode:o}));continue}if(l==="matrix"){e=e.replace(r,`;${w(n,a)}`);continue}e=e.replace(r,l==="label"?`.${encodeURIComponent(a)}`:encodeURIComponent(a))}return e}function F(i){return i instanceof FormData?i:JSON.stringify(i)}function N(i,t){let e=`${t.baseUrl}${i}`;t.params?.path&&(e=k(e,t.params.path));let r=t.querySerializer(t.params.query??{});return r.startsWith("?")&&(r=r.substring(1)),r&&(e+=`?${r}`),e}function O(...i){let t=new Headers;for(let e of i){if(!e||typeof e!="object")continue;let r=e instanceof Headers?e.entries():Object.entries(e);for(let[n,o]of r)if(o===null)t.delete(n);else if(Array.isArray(o))for(let l of o)t.append(n,l);else o!==void 0&&t.set(n,o)}return t}export{N as createFinalURL,z as createQuerySerializer,L as default,F as defaultBodySerializer,k as defaultPathSerializer,O as mergeHeaders,P as randomID,U as serializeArrayParam,q as serializeObjectParam,w as serializePrimitiveParam};
