"use strict";const unplugin=require("unplugin"),bundlerPluginCore=require("@codecov/bundler-plugin-core"),l=require("node:path");function _interopDefaultCompat(e){return e&&typeof e=="object"&&"default"in e?e.default:e}const l__default=_interopDefaultCompat(l),z="@codecov/vite-plugin",p="0.0.1-beta.10",viteBundleAnalysisPlugin=({output:e})=>({version:"1",name:z,pluginVersion:p,buildStart:()=>{e.start(),e.setPlugin(z,p)},buildEnd:()=>{e.end()},writeBundle:async()=>{await e.write()},vite:{generateBundle(s,o){if(!e.bundleName||e.bundleName===""){bundlerPluginCore.red("Bundle name is not present or empty. Skipping upload.");return}e.setBundleName(e.bundleName),s.name&&s.name!==""&&e.setBundleName(`${e.bundleName}-${s.name}`);const c=s.format==="es"?"esm":s.format;e.setBundleName(`${e.bundleName}-${c}`);const u=process.cwd(),m=[],b=[],d=new Map,$=Object.values(o),r={moduleOriginalSize:!1,...s};let f="";typeof r.assetFileNames=="string"&&(f=r.assetFileNames);let N="";typeof r.chunkFileNames=="string"&&(N=r.chunkFileNames);let v=0;for(const n of $){if(n?.type==="asset")if(typeof n.source=="string"){const t=n?.fileName??"",i=Buffer.from(n.source).byteLength;if(l__default.extname(t)===".map")continue;m.push({name:t,size:i,normalized:bundlerPluginCore.normalizePath(t,f)})}else{const t=n?.fileName??"",i=n?.source.byteLength;if(l__default.extname(t)===".map")continue;m.push({name:t,size:i,normalized:bundlerPluginCore.normalizePath(t,f)})}if(n?.type==="chunk"){const t=n?.name??"",i=n?.fileName??"",x=Object.entries(n?.modules??{}),_=Buffer.from(n?.code).byteLength,h=`${v}-${t}`;if(l__default.extname(i)===".map")continue;m.push({name:i,size:_,normalized:bundlerPluginCore.normalizePath(i,N)}),b.push({id:t,uniqueId:h,entry:n?.isEntry,initial:n?.isDynamicEntry,files:[i],names:[n?.name]});for(const[q,B]of x){const w=q.replace("\0",""),g=l__default.relative(u,w),y=g.match(/^\.\./)?g:`.${l__default.sep}${g}`,P=d.get(y);if(P)P.chunkUniqueIds.push(h);else{const A=r.moduleOriginalSize?B.originalLength:B.renderedLength,E={name:y,size:A,chunkUniqueIds:[h]};d.set(y,E)}}v+=1}}const k=Array.from(d.values());e.bundler={name:"rollup",version:this.meta.rollupVersion},e.assets=m,e.chunks=b,e.modules=k,e.outputPath=s.dir??"",e.dryRun&&this.emitFile({type:"asset",fileName:`${e.bundleName}-stats.json`,source:e.bundleStatsToJson()})}}}),a=unplugin.createVitePlugin((e,s)=>{if(bundlerPluginCore.checkNodeVersion(s))return[];const o=bundlerPluginCore.normalizeOptions(e);if(!o.success){const{shouldExit:u}=bundlerPluginCore.handleErrors(o);return u&&process.exit(1),[]}const c=[];if(o.options.enableBundleAnalysis){const u=new bundlerPluginCore.Output(o.options);c.push(viteBundleAnalysisPlugin({output:u}))}return c}),codecovVitePlugin=a,_internal_viteBundleAnalysisPlugin=viteBundleAnalysisPlugin;exports._internal_viteBundleAnalysisPlugin=_internal_viteBundleAnalysisPlugin,exports.codecovVitePlugin=codecovVitePlugin;
//# sourceMappingURL=index.cjs.map
